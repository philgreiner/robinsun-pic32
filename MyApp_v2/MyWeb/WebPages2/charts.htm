~inc:header.inc~
<div id="content">

<title>Live data from Robinsun!</title>

<h1>Data from Robinsun:</h1>
<h2>Current time: <span id="time" style="font-weight:normal">-</span></h2>

<div>
	<h2> Sonars </h2>
	<h3> 1) <span id="sonar1" style="font-weight:normal">-</span> [cm]; 2) <span id="sonar2" style="font-weight:normal">-</span> [cm]; 3) <span id="sonar3" style="font-weight:normal">-</span> [cm] </h3><br>
	<h3> 4) <span id="sonar4" style="font-weight:normal">-</span> [cm]; 5) <span id="sonar5" style="font-weight:normal">-</span> [cm]; 6) <span id="sonar6" style="font-weight:normal">-</span> [cm] </h3><br>
	<h2> IR Sensors </h2>
	<h3> Left: <span id="irL" style="font-weight:normal">-</span> [cm]; Right: <span id="irR" style="font-weight:normal">-</span> [cm] </h3><br>
	<h3> Blocks: <span id="speed_blocks" style="font-weight:normal">-</span> [cm/s] - Command: <span id="command_blocks" style="font-weight:normal">-</span> [/100] </h3><br>
	<h3> Fish horizontal: <span id="speed_fish_horizontal" style="font-weight:normal">-</span> [cm/s] - Command: <span id="command_fish_horizontal" style="font-weight:normal">-</span> [/100] </h3><br>
	<h3> Fish vertical: <span id="speed_fish_vertical" style="font-weight:normal">-</span> [cm/s] - Command: <span id="command_fish_vertical" style="font-weight:normal">-</span> [/100] </h3><br>
</div>

<br>
<br>
<div id="leftB">
	<img src="../images/button0.png" id="buttonL">
	<h3> Left switch: <span id="buttonleft" style="font-weight:normal">-</span> </h3>
</div>
<div id="rightB">
	<img src="../images/button1.png" id="buttonR">
	<h3> Right switch: <span id="buttonright" style="font-weight:normal">-</span> </h3>
</div>
<div id="charts">
<button class="button" id='chartsbutton' style="vertical-align:middle"><span>Play/Pause </span></button>
<div id="left">
	<h3> Left wheel speed: <span id="l_wheel_speed" style="font-weight:normal">-</span> [cm/s] - Reference Value: <span id="omegaref_L" style="font-weight:normal">-</span> [cm/s]</h3>
	<h3> Left odometer: <span id="odometer_L" style="font-weight:normal">-</span> [cm/s] </h3>
	<canvas id="leftwheel" width="600" height="300"></canvas>
</div>
<div id="right">
	<h3> Right wheel speed: <span id="r_wheel_speed" style="font-weight:normal">-</span> [cm/s] - Reference Value: <span id="omegaref_R" style="font-weight:normal">-</span> [cm/s]</h3>
	<h3> Right odometer: <span id="odometer_R" style="font-weight:normal">-</span> [cm/s] </h3>
	<canvas id="rightwheel" width="600" height="300"></canvas>
</div>
</div> <!-- charts !-->
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

<div>
	<h2>Robot state</h2>
	<h3> Competition state: <span id="competition_state" style="font-weight:normal">-</span> --> <span id="current_progress" style="font-weight:normal">-</span></h3>
	<h3> Clamp state: <span id="clamp" style="font-weight:normal">-</span></h3>
</div>
<br>
<div id="mapdiv">
	<img src="images/positionmark.png" id="positionmark" onmousemove="move(event);" style="display: none; position: absolute;"  height="96" />
	<img src="images/goalgear.png" id="goalgear" onmousemove="move(event);" style="display: none; position: absolute;"  height="80" />
	<img src="images/opponent.png" id="opponent" onmousemove="move(event);" style="display: none; position: absolute;"  height="50" />
	<img src="../images/map.png" alt="map" id="map" onmousemove="move(event);" onclick="click(event);" height="720" width="960"/>
	<h2> Position X: <span id="position0" style="font-weight:normal">-</span> [m] - Y: <span id="position1" style="font-weight:normal">-</span> [m] - Theta: <span id="position2" style="font-weight:normal">-</span> [deg]</h2>
	<h3> Goal X: <span id="goal0" style="font-weight:normal">-</span> [m] - Y: <span id="goal1" style="font-weight:normal">-</span> [m] - Theta: <span id="goal2" style="font-weight:normal">-</span> [deg]</h3>
	<h3> Opponent X: <span id="opponent0" style="font-weight:normal">-</span> [m] - Y: <span id="opponent1" style="font-weight:normal">-</span> [m]</h3>
	<h3> Mouse  <span id="mousepos" style="font-weight:normal">-</span> </h3>
</div> <!-- map !-->

</div> <!-- content !-->

<script type="text/javascript">
<!--
// Updates the graphs
var rightwheelspeed = new TimeSeries();
var leftwheelspeed = new TimeSeries();
var omegaref_R = new TimeSeries();
var omegaref_L = new TimeSeries();

setInterval(function() {
        rightwheelspeed.append(new Date().getTime(), document.getElementById('r_wheel_speed').innerHTML);
        leftwheelspeed.append(new Date().getTime(), document.getElementById('l_wheel_speed').innerHTML);
		omegaref_R.append(new Date().getTime(), document.getElementById('omegaref_R').innerHTML);
        omegaref_L.append(new Date().getTime(), document.getElementById('omegaref_L').innerHTML);
      }, 250);
	  
	function constantrange(range) {
	var min = -50;
	var max = 50;
		return {min: min, max: max};
	}
		
	// Light blue: 153, 204, 204
	// Robinsun: 79, 124, 164
	var rightwheel = new SmoothieChart({millisPerPixel:25,grid:{fillStyle:'#ffffff',strokeStyle:'#000000',sharpLines:true,millisPerLine:5000,verticalSections:6},labels:{fillStyle:'#000000',fontSize:14},yRangeFunction:constantrange,timestampFormatter:SmoothieChart.timeFormatter});
	rightwheel.addTimeSeries(rightwheelspeed, { strokeStyle: 'rgb(0, 114, 189)', lineWidth: 3 });
	rightwheel.addTimeSeries(omegaref_R, { strokeStyle: 'rgb(217, 83, 25)', lineWidth: 3 });
	rightwheel.streamTo(document.getElementById("rightwheel"), 250);

	var leftwheel = new SmoothieChart({millisPerPixel:25,grid:{fillStyle:'#ffffff',strokeStyle:'#000000',sharpLines:true,millisPerLine:5000,verticalSections:6},labels:{fillStyle:'#000000',fontSize:14},yRangeFunction:constantrange,timestampFormatter:SmoothieChart.timeFormatter});
	leftwheel.addTimeSeries(leftwheelspeed, { strokeStyle: 'rgb(0, 114, 189)', lineWidth: 3 });
	leftwheel.addTimeSeries(omegaref_L, { strokeStyle: 'rgb(217, 83, 25)', lineWidth: 3 });
	leftwheel.streamTo(document.getElementById("leftwheel"), 250);

	var isRunning = true;
	document.getElementById('chartsbutton').onclick = function()
	{
		if (isRunning)
		{
			rightwheel.stop();
			leftwheel.stop();
			document.getElementById("chartsbutton").style.background='#e7e7e7';
			document.getElementById("chartsbutton").style.color='black';
		}
		else
		{
			rightwheel.start();
			leftwheel.start();			
			document.getElementById("chartsbutton").style.background='#555555';
			document.getElementById("chartsbutton").style.color='white';
		}
		isRunning = !isRunning;
	};

	
//-->
</script>
	
<script type="text/javascript">
// Parses the xmlResponse from status.xml and updates the status box
function updateStatus(xmlData) {
	// Update r_wheel_speed value
	document.getElementById('r_wheel_speed').innerHTML = getXMLValue(xmlData, 'r_wheel_speed');
    // Update l_wheel_speed value
	document.getElementById('l_wheel_speed').innerHTML = getXMLValue(xmlData, 'l_wheel_speed');
	// Update omegaref_R value
	document.getElementById('omegaref_R').innerHTML = getXMLValue(xmlData, 'omegaref_R');
    // Update omegaref_L value
	document.getElementById('omegaref_L').innerHTML = getXMLValue(xmlData, 'omegaref_L');
	// Update odometer_R value
	document.getElementById('odometer_R').innerHTML = getXMLValue(xmlData, 'odometer_R');
    // Update odometer_L value
	document.getElementById('odometer_L').innerHTML = getXMLValue(xmlData, 'odometer_L');
	
	// Update sonar values
	document.getElementById('sonar1').innerHTML = getXMLValue(xmlData, 'sonar1');
	document.getElementById('sonar2').innerHTML = getXMLValue(xmlData, 'sonar2');
	document.getElementById('sonar3').innerHTML = getXMLValue(xmlData, 'sonar3');
	document.getElementById('sonar4').innerHTML = getXMLValue(xmlData, 'sonar4');
	document.getElementById('sonar5').innerHTML = getXMLValue(xmlData, 'sonar5');
	document.getElementById('sonar6').innerHTML = getXMLValue(xmlData, 'sonar6');
	
	// Update IR Sensor values
	document.getElementById('irL').innerHTML = getXMLValue(xmlData, 'irL');
	document.getElementById('irR').innerHTML = getXMLValue(xmlData, 'irR');	
	
	// Block speeds
	document.getElementById('speed_blocks').innerHTML = getXMLValue(xmlData, 'speed_blocks');
	document.getElementById('command_blocks').innerHTML = getXMLValue(xmlData, 'command_blocks');
	
	// Fish
	document.getElementById('speed_fish_horizontal').innerHTML = getXMLValue(xmlData, 'speed_fish_horizontal');
	document.getElementById('speed_fish_vertical').innerHTML = getXMLValue(xmlData, 'speed_fish_vertical');
	document.getElementById('command_fish_horizontal').innerHTML = getXMLValue(xmlData, 'command_fish_horizontal');
	document.getElementById('command_fish_vertical').innerHTML = getXMLValue(xmlData, 'command_fish_vertical');
	
	// Global
	document.getElementById('time').innerHTML = getXMLValue(xmlData, 'time');
	document.getElementById('competition_state').innerHTML = getXMLValue(xmlData, 'competition_state');
	document.getElementById('current_progress').innerHTML = getXMLValue(xmlData, 'current_progress');
	document.getElementById('clamp').innerHTML = getXMLValue(xmlData, 'clamp');

}
setTimeout("newAJAXCommand('status.xml', updateStatus, true)",250);
//-->
</script>

<script type="text/javascript">
<!-- 
// Updates the switch values and images displayed accordingly
var buttonL = 0;
var buttonR = 0;
function updateSwitches(xmlData){
		buttonL = getXMLValue(xmlData, 'buttonL');
		if(parseInt(buttonL) == 0)
			document.getElementById('buttonL').src = "../images/button0.png";
		else document.getElementById('buttonL').src = "../images/button1.png";
		
		document.getElementById('buttonleft').innerHTML = buttonL;//getXMLValue(xmlData, 'buttonL');
	
		buttonR = getXMLValue(xmlData, 'buttonR');
		if(parseInt(buttonR) == 0)
			document.getElementById('buttonR').src = "../images/button0.png";
		else document.getElementById('buttonR').src = "../images/button1.png";
		
		document.getElementById('buttonright').innerHTML = buttonR;//getXMLValue(xmlData, 'buttonR');
}
</script>

<script type="text/javascript">
function getScrollXY() {
  var scrOfX = 0, scrOfY = 0;
  if( typeof( window.pageYOffset ) == 'number' ) {
    //Netscape compliant
    scrOfY = window.pageYOffset;
    scrOfX = window.pageXOffset;
  } else if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) ) {
    //DOM compliant
    scrOfY = document.body.scrollTop;
    scrOfX = document.body.scrollLeft;
  } else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
    //IE6 standards compliant mode
    scrOfY = document.documentElement.scrollTop;
    scrOfX = document.documentElement.scrollLeft;
  }
  return new Array(scrOfX, scrOfY);
}

function move(event){
    var mouse_x = event.clientX;
    var mouse_y = event.clientY;

    var image_x = document.getElementById("map").offsetLeft;
    var image_y = document.getElementById("map").offsetTop;

    var scroll = getScrollXY();
	var scroll_x = scroll[0];
    var scroll_y = scroll[1];

    var point_x = mouse_x - image_x + scroll_x;
    var point_y = mouse_y - image_y + scroll_y;

    position_x = point_x*3/880 - 1.63;
    position_y = point_y*2/605 - 1.12;
    document.getElementById("mousepos").innerHTML = "X = " + position_y.toFixed(3) + " [m]; Y = " + position_x.toFixed(3)  + " [m]";

    pixX = mouse_x + scroll_x;
    pixY = mouse_y + scroll_y;
}
</script>

<script type="text/javascript">
	// Position
function updatePos(xmlData){
	var pos0 = getXMLValue(xmlData, 'position0');
	var pos1 = getXMLValue(xmlData, 'position1');
	var pos2 = getXMLValue(xmlData, 'position2');

	document.getElementById('position0').innerHTML = pos0;
	document.getElementById('position1').innerHTML = pos1;
	document.getElementById('position2').innerHTML = pos2;

	var goal0 = getXMLValue(xmlData, 'goal0');
	var goal1 = getXMLValue(xmlData, 'goal1');
	var goal2 = getXMLValue(xmlData, 'goal2');

	document.getElementById('goal0').innerHTML = goal0;
	document.getElementById('goal1').innerHTML = goal1;
	document.getElementById('goal2').innerHTML = goal2;
	
	var opponent0 = getXMLValue(xmlData, 'opponent0');
	var opponent1 = getXMLValue(xmlData, 'opponent1');

	document.getElementById('opponent0').innerHTML = opponent0;
	document.getElementById('opponent1').innerHTML = opponent1;	
	
	var image_x = document.getElementById("map").offsetLeft;
	var image_y = document.getElementById("map").offsetTop;
	with(document.getElementById('positionmark'))
	{
		style.left = pos1*888/3+image_x+444+34-64+'px';
		style.top = pos0*614/2+image_y+307+72-48-0.16*614/2+'px';
		style.transform  = "rotate("+(180-pos2)+"deg)";
		style.display = 'block';
	}
	with(document.getElementById('goalgear'))
	{
		style.left = goal1*888/3+image_x+444+34-40+'px';
		style.top = goal0*614/2+image_y+307+72-39-0.16*614/2+'px';
		style.transform  = "rotate("+(180-goal2)+"deg)";
		style.display = 'block';
	}
	with(document.getElementById('opponent'))
	{
		style.left = opponent0*888/3+image_x+444+34-25+'px';
		style.top = opponent1*614/2+image_y+307+72-25-0.16*614/2+'px';
		style.display = 'block';
	}
}
setTimeout("newAJAXCommand('status.xml', updatePos, true)",250);
</script>
~inc:footer.inc~