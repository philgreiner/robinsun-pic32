~inc:header.inc~
<div id="content">

<title>Live data from Robinsun!</title>

<h1>Data from Robinsun:</h1>
	<div id="leftB">
		<img src="../images/button0.png" id="buttonL">
		<p> Left switch: <span id="buttonleft" style="font-weight:normal">-</span> </p>
	</div>
	<div id="rightB">
		<img src="../images/button1.png" id="buttonR">
		<p> Right switch: <span id="buttonright" style="font-weight:normal">-</span> </p>
	</div>
<div id="charts">
<div id="left">
	<p> Left wheel speed: <span id="l_wheel_speed" style="font-weight:normal">-</span> [rad/s] - Reference Value: <span id="omegaref_L" style="font-weight:normal">-</span> [rad/s]</p>
	<p> Left odometer: <span id="odometer_L" style="font-weight:normal">-</span> [rad/s] </p>
	<canvas id="leftwheel" width="600" height="200"></canvas>
</div>
<div id="right">
	<p> Right wheel speed: <span id="r_wheel_speed" style="font-weight:normal">-</span> [rad/s] - Reference Value: <span id="omegaref_R" style="font-weight:normal">-</span> [rad/s]</p>
	<p> Right odometer: <span id="odometer_R" style="font-weight:normal">-</span> [rad/s] </p>
	<canvas id="rightwheel" width="600" height="200"></canvas>
</div>
</div> <!-- charts !-->

<div>
	<p> Sonars </p>
	<p> 1) <span id="sonar1" style="font-weight:normal">-</span> [cm]; 2) <span id="sonar2" style="font-weight:normal">-</span> [cm]; 3) <span id="sonar3" style="font-weight:normal">-</span> [cm] </p>
	<p> 4) <span id="sonar4" style="font-weight:normal">-</span> [cm]; 5) <span id="sonar5" style="font-weight:normal">-</span> [cm]; 6) <span id="sonar6" style="font-weight:normal">-</span> [cm] </p>
	<p> Blocks: <span id="speed_blocks" style="font-weight:normal">-</span> [rad/s] - Command: <span id="command_blocks" style="font-weight:normal">-</span> [/100] </p>
	<p> Fish horizontal: <span id="speed_fish_horizontal" style="font-weight:normal">-</span> [rad/s] - Command: <span id="command_fish_horizontal" style="font-weight:normal">-</span> [/100] </p>
	<p> Fish vertical: <span id="speed_fish_vertical" style="font-weight:normal">-</span> [rad/s] - Command: <span id="command_fish_vertical" style="font-weight:normal">-</span> [/100] </p>
</div>


<div id="mapdiv">
	<img src="images/positionmark.png" id="positionmark" style="display: none; position: absolute;"  height="25" />
	<img src="../images/map.png" alt="map" id="map" onmousemove="move(event);" onclick="click(event);" height="360" width="480"/>
	<p> Position X: <span id="position0" style="font-weight:normal">-</span> [m] - Y: <span id="position1" style="font-weight:normal">-</span> [m] - Theta: <span id="position2" style="font-weight:normal">-</span> [deg]</p>
</div> <!-- map !-->

</div> <!-- content !-->

<script type="text/javascript">
<!--
// Updates the graphs
var rightwheelspeed = new TimeSeries();
var leftwheelspeed = new TimeSeries();
var omegaref_R = new TimeSeries();
var omegaref_L = new TimeSeries();

setInterval(function() {
        rightwheelspeed.append(new Date().getTime(), document.getElementById('r_wheel_speed').innerHTML);
        leftwheelspeed.append(new Date().getTime(), document.getElementById('l_wheel_speed').innerHTML);
		omegaref_R.append(new Date().getTime(), document.getElementById('omegaref_R').innerHTML);
        omegaref_L.append(new Date().getTime(), document.getElementById('omegaref_L').innerHTML);
      }, 250);
	  
	// Light blue: 153, 204, 204
	// Robinsun: 79, 124, 164
	var rightwheel = new SmoothieChart();
	rightwheel.addTimeSeries(rightwheelspeed, { strokeStyle: 'rgb(79, 124, 164)', fillStyle: 'rgba(79, 124, 164, 0.4)', lineWidth: 3 });
	rightwheel.addTimeSeries(omegaref_R, { strokeStyle: 'rgb(153, 204, 204)', fillStyle: 'rgba(153, 204, 204, 0.4)', lineWidth: 3 });
	rightwheel.streamTo(document.getElementById("rightwheel"), 250);

	var leftwheel = new SmoothieChart();
	leftwheel.addTimeSeries(leftwheelspeed, { strokeStyle: 'rgb(79, 124, 164)', fillStyle: 'rgba(79, 124, 164, 0.4)', lineWidth: 3 });
	leftwheel.addTimeSeries(omegaref_L, { strokeStyle: 'rgb(153, 204, 204)', fillStyle: 'rgba(153, 204, 204, 0.4)', lineWidth: 3 });
	leftwheel.streamTo(document.getElementById("leftwheel"), 250);
//-->
</script>
	
<script type="text/javascript">
// Parses the xmlResponse from status.xml and updates the status box
function updateStatus(xmlData) {
	// Update r_wheel_speed value
	document.getElementById('r_wheel_speed').innerHTML = getXMLValue(xmlData, 'r_wheel_speed');
    // Update l_wheel_speed value
	document.getElementById('l_wheel_speed').innerHTML = getXMLValue(xmlData, 'l_wheel_speed');
	// Update omegaref_R value
	document.getElementById('omegaref_R').innerHTML = getXMLValue(xmlData, 'omegaref_R');
    // Update omegaref_L value
	document.getElementById('omegaref_L').innerHTML = getXMLValue(xmlData, 'omegaref_L');
	// Update odometer_R value
	document.getElementById('odometer_R').innerHTML = getXMLValue(xmlData, 'odometer_R');
    // Update odometer_L value
	document.getElementById('odometer_L').innerHTML = getXMLValue(xmlData, 'odometer_L');
	
	// Update sonar values
	document.getElementById('sonar1').innerHTML = getXMLValue(xmlData, 'sonar1');
	document.getElementById('sonar2').innerHTML = getXMLValue(xmlData, 'sonar2');
	document.getElementById('sonar3').innerHTML = getXMLValue(xmlData, 'sonar3');
	document.getElementById('sonar4').innerHTML = getXMLValue(xmlData, 'sonar4');
	document.getElementById('sonar5').innerHTML = getXMLValue(xmlData, 'sonar5');
	document.getElementById('sonar6').innerHTML = getXMLValue(xmlData, 'sonar6');
	
	// Block speeds
	document.getElementById('speed_blocks').innerHTML = getXMLValue(xmlData, 'speed_blocks');
	document.getElementById('command_blocks').innerHTML = getXMLValue(xmlData, 'command_blocks');
	
	// Fish
	document.getElementById('speed_fish_horizontal').innerHTML = getXMLValue(xmlData, 'speed_fish_horizontal');
	document.getElementById('speed_fish_vertical').innerHTML = getXMLValue(xmlData, 'speed_fish_vertical');
	document.getElementById('command_fish_horizontal').innerHTML = getXMLValue(xmlData, 'command_fish_horizontal');
	document.getElementById('command_fish_vertical').innerHTML = getXMLValue(xmlData, 'command_fish_vertical');
}
setTimeout("newAJAXCommand('status.xml', updateStatus, true)",250);
//-->
</script>

<script type="text/javascript">
<!-- 
// Updates the switch values and images displayed accordingly
var buttonL = 0;
var buttonR = 0;
function updateSwitches(xmlData){
		buttonL = getXMLValue(xmlData, 'buttonL');
		if(parseInt(buttonL) == 0)
			document.getElementById('buttonL').src = "../images/button0.png";
		else document.getElementById('buttonL').src = "../images/button1.png";
		
		document.getElementById('buttonleft').innerHTML = buttonL;//getXMLValue(xmlData, 'buttonL');
	
		buttonR = getXMLValue(xmlData, 'buttonR');
		if(parseInt(buttonR) == 0)
			document.getElementById('buttonR').src = "../images/button0.png";
		else document.getElementById('buttonR').src = "../images/button1.png";
		
		document.getElementById('buttonright').innerHTML = buttonR;//getXMLValue(xmlData, 'buttonR');
}
</script>

<script type="text/javascript">
function getScrollXY() {
  var scrOfX = 0, scrOfY = 0;
  if( typeof( window.pageYOffset ) == 'number' ) {
    //Netscape compliant
    scrOfY = window.pageYOffset;
    scrOfX = window.pageXOffset;
  } else if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) ) {
    //DOM compliant
    scrOfY = document.body.scrollTop;
    scrOfX = document.body.scrollLeft;
  } else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
    //IE6 standards compliant mode
    scrOfY = document.documentElement.scrollTop;
    scrOfX = document.documentElement.scrollLeft;
  }
  return new Array(scrOfX, scrOfY);
}

function move(event){
    var mouse_x = event.clientX;
    var mouse_y = event.clientY;
 
    var image_x = document.getElementById("map").offsetLeft;
    var image_y = document.getElementById("map").offsetTop;
     
    var scroll = getScrollXY();
	var scroll_x = scroll[0];
    var scroll_y = scroll[1];
 
    var point_x = mouse_x - image_x + scroll_x;
    var point_y = mouse_y - image_y + scroll_y;
    
    position_x = point_x*3/480;
    position_y = point_y*2/360;
    //document.getElementById("info_position").innerHTML = "x = " + position_x.toFixed(3)  + " m : y = " + position_y.toFixed(3) + " m";
    
    pixX = mouse_x + scroll_x;
    pixY = mouse_y + scroll_y;
}
</script>

<script type="text/javascript">
	// Position
function updatePos(xmlData){
	var pos0 = getXMLValue(xmlData, 'position0');
	var pos1 = getXMLValue(xmlData, 'position1');
	var pos2 = getXMLValue(xmlData, 'position2');

	document.getElementById('position0').innerHTML = pos0;
	document.getElementById('position1').innerHTML = pos1;
	document.getElementById('position2').innerHTML = pos2;

	var image_x = document.getElementById("map").offsetLeft;
	var image_y = document.getElementById("map").offsetTop;
	with(document.getElementById('positionmark'))
	{
		style.left = pos1*480/3+image_x+240+'px';
		style.top = pos0*360/2+image_y+180+'px';
		style.transform  = "rotate("+(180-pos2)+"deg)";
		style.display = 'block';
	}
}
setTimeout("newAJAXCommand('status.xml', updatePos, true)",250);
</script>
~inc:footer.inc~